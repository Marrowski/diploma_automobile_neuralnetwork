{% extends 'base.html' %}
{% load static %} {% block title %}Профіль{% endblock %}
{% block content %}

{% if messages %}
<div class="container mx-auto max-w-2xl px-4 mt-6 space-y-2">
  {% for message in messages %}
    <div class="rounded-xl px-4 py-3 text-sm shadow
                {% if 'success' in message.tags %} bg-blue-50 text-blue-900 border border-blue-200
                {% elif 'error' in message.tags %} bg-red-50 text-red-900 border border-red-200
                {% else %} bg-gray-50 text-gray-800 border border-gray-200 {% endif %}">
      {{ message }}
    </div>
  {% endfor %}
</div>
{% endif %}

    {% block header_extra %}{% endblock %}
<div class="container mx-auto px-4 py-8">
  <div class="max-w-lg mx-auto bg-white/90 text-gray-900 rounded-xl border border-blue-200 shadow-md p-6">
    <h2 class="text-xl font-semibold text-center text-blue-900 mb-4">Налаштування профілю</h2>

    <form method="post" enctype="multipart/form-data" class="space-y-4">
      {% csrf_token %}

      <div class="grid grid-cols-[48px,1fr] gap-4 items-start">
        <div class="flex flex-col items-center gap-2">

          {% if form.instance.avatar %}
            <img id="avatarPreview" src="{{ form.instance.avatar.url }}"
                 alt="Аватар" class="w-10 h-10 rounded-full object-cover shadow" />

          {% else %}
            <img id="avatarPlaceholder"
                 src="{% static 'media/user.png' %}"
                 alt="Аватар"
                 class="w-10 h-10 rounded-full object-cover shadow" />

            <img id="avatarPreview" class="w-10 h-10 rounded-full object-cover shadow hidden" alt="Прев'ю" />
          {% endif %}

          <p class="text-[11px] text-blue-700/80 text-center">PNG/JPG, до 5&nbsp;МБ</p>
        </div>

        <div>
          <label for="{{ form.avatar.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
            {{ form.avatar.label|default:"Змінити аватар" }}
          </label>
          <div class="relative">
            {{ form.avatar }}
            <svg xmlns="http://www.w3.org/2000/svg"
                 class="w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-blue-600 pointer-events-none"
                 viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 5a3 3 0 0 1 3 3h2a3 3 0 0 1 3 3v7a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-7a3 3 0 0 1 3-3h2a3 3 0 0 1 3-3Z"/>
            </svg>
          </div>
          {% if form.avatar.errors %}
            <p class="mt-2 text-xs text-red-600">{{ form.avatar.errors.0 }}</p>
          {% endif %}
        </div>
      </div>

      <div class="pt-2">
        <button type="submit"
                class="w-full py-2 rounded-lg bg-blue-700 text-white text-sm font-semibold shadow hover:bg-blue-800 transition">
          Зберегти зміни
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  (function () {
    const input = document.getElementById('{{ form.avatar.id_for_label }}');
    const img = document.getElementById('avatarPreview');
    const ph  = document.getElementById('avatarPlaceholder');
    if (input) {
      input.addEventListener('change', (e) => {
        const f = e.target.files && e.target.files[0];
        if (!f) return;
        const url = URL.createObjectURL(f);
        if (ph) ph.classList.add('hidden');
        img.src = url;
        img.classList.remove('hidden');
      });
    }
  })();
</script>

{% endblock %}